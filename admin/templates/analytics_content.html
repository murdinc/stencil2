{{define "content"}}
<div class="content-header">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2>Analytics</h2>
            <p>Traffic and engagement metrics for {{.Website.SiteName}}</p>
        </div>
        <div style="background: #48bb78; color: white; padding: 12px 24px; border-radius: 8px; text-align: center;">
            <div style="font-size: 32px; font-weight: bold;">{{.ActiveUsers}}</div>
            <div style="font-size: 13px; opacity: 0.9;">Active Users Now</div>
        </div>
    </div>
</div>

<!-- Time Period Selector -->
<div class="card" style="margin-bottom: 20px;">
    <form method="GET" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; align-items: end;">
        <div>
            <label style="display: block; margin-bottom: 4px; font-weight: 600; font-size: 14px;">Time Period</label>
            <select name="days" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" onchange="this.form.submit()">
                <option value="7" {{if eq .Days 7}}selected{{end}}>Last 7 days</option>
                <option value="30" {{if eq .Days 30}}selected{{end}}>Last 30 days</option>
                <option value="90" {{if eq .Days 90}}selected{{end}}>Last 90 days</option>
                <option value="365" {{if eq .Days 365}}selected{{end}}>Last year</option>
            </select>
        </div>
        <div style="padding-top: 24px; font-size: 14px; color: #666;">
            {{.StartDate}} to {{.EndDate}}
        </div>
    </form>
</div>

<!-- Overview Stats -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="card" style="text-align: center; padding: 24px;">
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">Total Pageviews</div>
        <div style="font-size: 32px; font-weight: bold; color: #2563eb;">{{index .Stats "total_views"}}</div>
    </div>
    <div class="card" style="text-align: center; padding: 24px;">
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">Unique Visitors</div>
        <div style="font-size: 32px; font-weight: bold; color: #48bb78;">{{index .Stats "unique_sessions"}}</div>
    </div>
    <div class="card" style="text-align: center; padding: 24px;">
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">Avg. Pages/Visit</div>
        <div style="font-size: 32px; font-weight: bold; color: #f59e0b;">{{printf "%.1f" .AvgPages}}</div>
    </div>
    <div class="card" style="text-align: center; padding: 24px;">
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">Bounce Rate</div>
        <div style="font-size: 32px; font-weight: bold; color: #ef4444;">{{printf "%.1f" .BounceRate}}%</div>
    </div>
    <div class="card" style="text-align: center; padding: 24px;">
        <div style="font-size: 13px; color: #666; margin-bottom: 8px;">Avg. Time on Site</div>
        <div style="font-size: 32px; font-weight: bold; color: #8b5cf6;">
            {{.SessionDurationDisplay}}
        </div>
    </div>
</div>

<!-- Traffic Chart -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Traffic & Revenue</h3>
    <div style="position: relative; height: 300px;">
        <canvas id="trafficChart"></canvas>
    </div>
</div>

<!-- Orders & Engagement Charts -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Orders & Engagement</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div>
            <h4 style="font-size: 14px; color: #666; margin-bottom: 10px; font-weight: normal;">Order Count</h4>
            <div style="position: relative; height: 200px;">
                <canvas id="ordersChart"></canvas>
            </div>
        </div>
        <div>
            <h4 style="font-size: 14px; color: #666; margin-bottom: 10px; font-weight: normal;">Engagement Metrics</h4>
            <div style="position: relative; height: 200px;">
                <canvas id="engagementChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Growth Metrics -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Growth</h3>
    <div style="position: relative; height: 250px;">
        <canvas id="growthChart"></canvas>
    </div>
</div>

<!-- E-Commerce Metrics -->
{{if .HasOrders}}
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">E-Commerce Performance</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
        <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Total Revenue</div>
            <div style="font-size: 28px; font-weight: bold; color: #48bb78;">${{printf "%.2f" (index .RevenueMetrics "total_revenue")}}</div>
        </div>
        <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Orders</div>
            <div style="font-size: 28px; font-weight: bold; color: #2563eb;">{{index .RevenueMetrics "total_orders"}}</div>
        </div>
        <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Avg. Order Value</div>
            <div style="font-size: 28px; font-weight: bold; color: #f59e0b;">${{printf "%.2f" (index .RevenueMetrics "avg_order_value")}}</div>
        </div>
        <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Conversion Rate</div>
            <div style="font-size: 28px; font-weight: bold; color: #8b5cf6;">{{printf "%.2f" .ConversionRate}}%</div>
            <div style="font-size: 11px; color: #999; margin-top: 4px;">{{.ConvertedSessions}} of {{.TotalSessions}} sessions</div>
        </div>
        {{if gt .TotalCarts 0}}
        <div style="text-align: center; padding: 20px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Cart Abandonment</div>
            <div style="font-size: 28px; font-weight: bold; color: #ef4444;">{{printf "%.1f" .AbandonmentRate}}%</div>
            <div style="font-size: 11px; color: #999; margin-top: 4px;">{{.AbandonedCarts}} of {{.TotalCarts}} carts</div>
        </div>
        {{end}}
    </div>
</div>
{{end}}

<!-- Device Breakdown -->
{{if .DeviceBreakdown}}
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Device Breakdown</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px;">
        {{if index .DeviceBreakdown "mobile"}}
        <div style="text-align: center; padding: 16px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Mobile</div>
            <div style="font-size: 24px; font-weight: bold; color: #2563eb;">{{index .DeviceBreakdown "mobile"}}</div>
        </div>
        {{end}}
        {{if index .DeviceBreakdown "tablet"}}
        <div style="text-align: center; padding: 16px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Tablet</div>
            <div style="font-size: 24px; font-weight: bold; color: #48bb78;">{{index .DeviceBreakdown "tablet"}}</div>
        </div>
        {{end}}
        {{if index .DeviceBreakdown "desktop"}}
        <div style="text-align: center; padding: 16px; background: #f7fafc; border-radius: 6px;">
            <div style="font-size: 12px; color: #666; margin-bottom: 6px;">Desktop</div>
            <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">{{index .DeviceBreakdown "desktop"}}</div>
        </div>
        {{end}}
    </div>
</div>
{{end}}

<!-- Current Activity (Real-time) -->
{{if gt .ActiveUsers 0}}
<div class="card" style="margin-bottom: 30px; border-left: 4px solid #48bb78;">
    <h3 style="margin-bottom: 20px;">ðŸŸ¢ Live Activity (Last 5 minutes)</h3>
    {{if .CurrentPages}}
    <table>
        <thead>
            <tr>
                <th style="text-align: left;">Page</th>
                <th style="text-align: center;">Active Viewers</th>
            </tr>
        </thead>
        <tbody>
            {{range .CurrentPages}}
            <tr>
                <td style="font-family: monospace; font-size: 14px;">{{index . "path"}}</td>
                <td style="text-align: center; font-weight: bold; color: #48bb78;">{{index . "viewers"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="text-align: center; color: #999; padding: 20px;">No active page views</p>
    {{end}}
</div>
{{end}}

<!-- Top Pages -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Top Pages</h3>
    {{if .TopPages}}
    <table>
        <thead>
            <tr>
                <th style="text-align: left;">Page</th>
                <th style="text-align: center;">Views</th>
                <th style="text-align: center;">Unique Visitors</th>
            </tr>
        </thead>
        <tbody>
            {{range .TopPages}}
            <tr>
                <td style="font-family: monospace; font-size: 14px;">{{index . "path"}}</td>
                <td style="text-align: center; font-weight: bold;">{{index . "views"}}</td>
                <td style="text-align: center;">{{index . "unique_visitors"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="text-align: center; color: #999; padding: 40px;">No pageview data yet</p>
    {{end}}
</div>

<!-- Entry & Exit Pages -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
    <div class="card">
        <h3 style="margin-bottom: 20px;">Top Entry Pages</h3>
        {{if .EntryPages}}
        <table>
            <thead>
                <tr>
                    <th style="text-align: left;">Page</th>
                    <th style="text-align: center;">Entries</th>
                </tr>
            </thead>
            <tbody>
                {{range .EntryPages}}
                <tr>
                    <td style="font-family: monospace; font-size: 13px;">{{index . "path"}}</td>
                    <td style="text-align: center; font-weight: bold;">{{index . "entries"}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <p style="text-align: center; color: #999; padding: 30px;">No data</p>
        {{end}}
    </div>

    <div class="card">
        <h3 style="margin-bottom: 20px;">Top Exit Pages</h3>
        {{if .ExitPages}}
        <table>
            <thead>
                <tr>
                    <th style="text-align: left;">Page</th>
                    <th style="text-align: center;">Exits</th>
                </tr>
            </thead>
            <tbody>
                {{range .ExitPages}}
                <tr>
                    <td style="font-family: monospace; font-size: 13px;">{{index . "path"}}</td>
                    <td style="text-align: center; font-weight: bold;">{{index . "exits"}}</td>
                </tr>
                {{end}}
            </tbody>
        </table>
        {{else}}
        <p style="text-align: center; color: #999; padding: 30px;">No data</p>
        {{end}}
    </div>
</div>

<!-- Top Referrers -->
<div class="card" style="margin-bottom: 30px;">
    <h3 style="margin-bottom: 20px;">Top Referrers</h3>
    {{if .TopReferrers}}
    <table>
        <thead>
            <tr>
                <th style="text-align: left;">Referrer</th>
                <th style="text-align: center;">Visits</th>
            </tr>
        </thead>
        <tbody>
            {{range .TopReferrers}}
            <tr>
                <td style="font-family: monospace; font-size: 14px; word-break: break-all;">
                    {{$ref := index . "referrer"}}
                    {{if eq $ref ""}}
                        <em style="color: #999;">Direct / None</em>
                    {{else}}
                        {{$ref}}
                    {{end}}
                </td>
                <td style="text-align: center; font-weight: bold;">{{index . "visits"}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <p style="text-align: center; color: #999; padding: 40px;">No referrer data available</p>
    {{end}}
</div>

<!-- Custom Events -->
{{if .EventStats}}
<div class="card">
    <h3 style="margin-bottom: 20px;">Custom Events</h3>
    <table>
        <thead>
            <tr>
                <th style="text-align: left;">Event Name</th>
                <th style="text-align: center;">Count</th>
            </tr>
        </thead>
        <tbody>
            {{range .EventStats}}
            {{if ne (index . "event_name") "heartbeat"}}
            <tr>
                <td style="font-family: monospace; font-size: 14px;">{{index . "event_name"}}</td>
                <td style="text-align: center; font-weight: bold;">{{index . "count"}}</td>
            </tr>
            {{end}}
            {{end}}
        </tbody>
    </table>
</div>
{{end}}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// Parse time series data from server
const timeSeriesData = JSON.parse({{.TimeSeriesJSON}});

// Prepare chart data
const labels = timeSeriesData.map(d => d.date);
const pageviews = timeSeriesData.map(d => d.pageviews);
const visitors = timeSeriesData.map(d => d.visitors);
const revenue = timeSeriesData.map(d => d.revenue);

// Create gradient for pageviews
const ctx = document.getElementById('trafficChart').getContext('2d');
const pageviewsGradient = ctx.createLinearGradient(0, 0, 0, 300);
pageviewsGradient.addColorStop(0, 'rgba(37, 99, 235, 0.2)');
pageviewsGradient.addColorStop(1, 'rgba(37, 99, 235, 0.0)');

const visitorsGradient = ctx.createLinearGradient(0, 0, 0, 300);
visitorsGradient.addColorStop(0, 'rgba(72, 187, 120, 0.2)');
visitorsGradient.addColorStop(1, 'rgba(72, 187, 120, 0.0)');

const revenueGradient = ctx.createLinearGradient(0, 0, 0, 300);
revenueGradient.addColorStop(0, 'rgba(245, 158, 11, 0.2)');
revenueGradient.addColorStop(1, 'rgba(245, 158, 11, 0.0)');

// Initialize chart
new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Pageviews',
            data: pageviews,
            borderColor: '#2563eb',
            backgroundColor: pageviewsGradient,
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#2563eb',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y'
        }, {
            label: 'Unique Visitors',
            data: visitors,
            borderColor: '#48bb78',
            backgroundColor: visitorsGradient,
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#48bb78',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y'
        }, {
            label: 'Revenue ($)',
            data: revenue,
            borderColor: '#f59e0b',
            backgroundColor: revenueGradient,
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#f59e0b',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 20,
                    font: {
                        size: 13,
                        weight: '500'
                    }
                }
            },
            tooltip: {
                backgroundColor: '#1f2937',
                titleColor: '#fff',
                bodyColor: '#d1d5db',
                borderColor: '#374151',
                borderWidth: 1,
                padding: 12,
                displayColors: true,
                callbacks: {
                    title: function(context) {
                        const dateStr = context[0].label;
                        const [year, month, day] = dateStr.split('-');
                        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                        return date.toLocaleDateString('en-US', {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric'
                        });
                    }
                }
            }
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    font: {
                        size: 12
                    },
                    color: '#6b7280'
                },
                grid: {
                    color: '#f3f4f6',
                    drawBorder: false
                },
                title: {
                    display: true,
                    text: 'Views / Visitors',
                    color: '#6b7280',
                    font: {
                        size: 11,
                        weight: '600'
                    }
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                ticks: {
                    precision: 2,
                    font: {
                        size: 12
                    },
                    color: '#f59e0b',
                    callback: function(value) {
                        return '$' + value.toFixed(2);
                    }
                },
                grid: {
                    drawOnChartArea: false,
                    drawBorder: false
                },
                title: {
                    display: true,
                    text: 'Revenue',
                    color: '#f59e0b',
                    font: {
                        size: 11,
                        weight: '600'
                    }
                }
            },
            x: {
                ticks: {
                    maxRotation: 0,
                    autoSkip: true,
                    maxTicksLimit: 10,
                    font: {
                        size: 11
                    },
                    color: '#6b7280',
                    callback: function(value, index) {
                        const dateStr = this.getLabelForValue(value);
                        const [year, month, day] = dateStr.split('-');
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return monthNames[parseInt(month) - 1] + ' ' + parseInt(day);
                    }
                },
                grid: {
                    display: false
                }
            }
        }
    }
});

// Parse engagement data
const engagementData = JSON.parse({{.EngagementJSON}});
const paidOrders = engagementData.map(d => d.paid_orders);
const pendingOrders = engagementData.map(d => d.pending_orders);
const avgPagesPerVisit = engagementData.map(d => d.avg_pages_per_visit);
const avgTimeOnSite = engagementData.map(d => d.avg_time_on_site);

// Order Count Chart
const ordersCtx = document.getElementById('ordersChart').getContext('2d');
new Chart(ordersCtx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Paid Orders',
            data: paidOrders,
            backgroundColor: '#10b981',
            borderColor: '#059669',
            borderWidth: 1
        }, {
            label: 'Pending Orders',
            data: pendingOrders,
            backgroundColor: '#f59e0b',
            borderColor: '#d97706',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: { size: 11, weight: '500' }
                }
            },
            tooltip: {
                backgroundColor: '#1f2937',
                titleColor: '#fff',
                bodyColor: '#d1d5db',
                borderColor: '#374151',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                    title: function(context) {
                        const dateStr = context[0].label;
                        const [year, month, day] = dateStr.split('-');
                        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                        return date.toLocaleDateString('en-US', {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric'
                        });
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                stacked: true,
                ticks: {
                    precision: 0,
                    font: { size: 11 },
                    color: '#6b7280'
                },
                grid: {
                    color: '#f3f4f6',
                    drawBorder: false
                }
            },
            x: {
                stacked: true,
                ticks: {
                    maxRotation: 0,
                    autoSkip: true,
                    maxTicksLimit: 7,
                    font: { size: 10 },
                    color: '#6b7280',
                    callback: function(value, index) {
                        const dateStr = this.getLabelForValue(value);
                        const [year, month, day] = dateStr.split('-');
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return monthNames[parseInt(month) - 1] + ' ' + parseInt(day);
                    }
                },
                grid: {
                    display: false
                }
            }
        }
    }
});

// Engagement Metrics Chart
const engagementCtx = document.getElementById('engagementChart').getContext('2d');
new Chart(engagementCtx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Pages/Visit',
            data: avgPagesPerVisit,
            borderColor: '#06b6d4',
            backgroundColor: 'rgba(6, 182, 212, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#06b6d4',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y'
        }, {
            label: 'Time on Site (s)',
            data: avgTimeOnSite,
            borderColor: '#ec4899',
            backgroundColor: 'rgba(236, 72, 153, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.4,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: '#ec4899',
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            yAxisID: 'y1'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: { size: 11, weight: '500' }
                }
            },
            tooltip: {
                backgroundColor: '#1f2937',
                titleColor: '#fff',
                bodyColor: '#d1d5db',
                borderColor: '#374151',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                    title: function(context) {
                        const dateStr = context[0].label;
                        const [year, month, day] = dateStr.split('-');
                        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                        return date.toLocaleDateString('en-US', {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric'
                        });
                    },
                    label: function(context) {
                        let label = context.dataset.label || '';
                        if (label) {
                            label += ': ';
                        }
                        if (context.parsed.y !== null) {
                            if (context.datasetIndex === 1) {
                                // Time on site - format as time
                                const seconds = Math.floor(context.parsed.y);
                                const mins = Math.floor(seconds / 60);
                                const secs = seconds % 60;
                                label += mins > 0 ? `${mins}m ${secs}s` : `${secs}s`;
                            } else {
                                label += context.parsed.y.toFixed(2);
                            }
                        }
                        return label;
                    }
                }
            }
        },
        scales: {
            y: {
                type: 'linear',
                display: true,
                position: 'left',
                beginAtZero: true,
                ticks: {
                    precision: 1,
                    font: { size: 11 },
                    color: '#06b6d4'
                },
                grid: {
                    color: '#f3f4f6',
                    drawBorder: false
                }
            },
            y1: {
                type: 'linear',
                display: true,
                position: 'right',
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    font: { size: 11 },
                    color: '#ec4899',
                    callback: function(value) {
                        return value + 's';
                    }
                },
                grid: {
                    drawOnChartArea: false,
                    drawBorder: false
                }
            },
            x: {
                ticks: {
                    maxRotation: 0,
                    autoSkip: true,
                    maxTicksLimit: 7,
                    font: { size: 10 },
                    color: '#6b7280',
                    callback: function(value, index) {
                        const dateStr = this.getLabelForValue(value);
                        const [year, month, day] = dateStr.split('-');
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return monthNames[parseInt(month) - 1] + ' ' + parseInt(day);
                    }
                },
                grid: {
                    display: false
                }
            }
        }
    }
});

// Growth Chart
const growthData = JSON.parse({{.GrowthJSON}});
const newCustomers = growthData.map(d => d.new_customers);
const newSMSSignups = growthData.map(d => d.new_sms_signups);

const growthCtx = document.getElementById('growthChart').getContext('2d');
new Chart(growthCtx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'New Customers',
            data: newCustomers,
            backgroundColor: '#8b5cf6',
            borderColor: '#7c3aed',
            borderWidth: 1
        }, {
            label: 'New SMS Signups',
            data: newSMSSignups,
            backgroundColor: '#06b6d4',
            borderColor: '#0891b2',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: {
                display: true,
                position: 'top',
                labels: {
                    usePointStyle: true,
                    padding: 15,
                    font: { size: 12, weight: '500' }
                }
            },
            tooltip: {
                backgroundColor: '#1f2937',
                titleColor: '#fff',
                bodyColor: '#d1d5db',
                borderColor: '#374151',
                borderWidth: 1,
                padding: 12,
                callbacks: {
                    title: function(context) {
                        const dateStr = context[0].label;
                        const [year, month, day] = dateStr.split('-');
                        const date = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
                        return date.toLocaleDateString('en-US', {
                            weekday: 'short',
                            month: 'short',
                            day: 'numeric'
                        });
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    precision: 0,
                    font: { size: 11 },
                    color: '#6b7280'
                },
                grid: {
                    color: '#f3f4f6',
                    drawBorder: false
                }
            },
            x: {
                ticks: {
                    maxRotation: 0,
                    autoSkip: true,
                    maxTicksLimit: 10,
                    font: { size: 11 },
                    color: '#6b7280',
                    callback: function(value, index) {
                        const dateStr = this.getLabelForValue(value);
                        const [year, month, day] = dateStr.split('-');
                        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                        return monthNames[parseInt(month) - 1] + ' ' + parseInt(day);
                    }
                },
                grid: {
                    display: false
                }
            }
        }
    }
});
</script>

{{end}}
