{{define "content"}}
<div class="content-header">
    <h2>Products</h2>
    <p>Manage products for {{.Website.SiteName}}</p>
</div>

<div class="card">
    <a href="/site/{{.Website.ID}}/products/new" class="btn btn-success">Create New Product</a>

    {{if .Products}}
    <table>
        <thead>
            <tr>
                <th>Reorder</th>
                <th>Name</th>
                <th>Slug</th>
                <th>Price</th>
                <th>SKU</th>
                <th>Stock</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {{$productCount := len .Products}}
            {{range $index, $product := .Products}}
            <tr>
                <td style="white-space:nowrap;">
                    <form style="display:inline;">
                    {{ $.CSRFField }}
                    {{if gt $index 0}}
                        <button type="submit" formmethod="POST" formaction="/site/{{$.Website.ID}}/products/{{$product.ID}}/reorder/up" class="btn btn-sm btn-success" style="padding:2px 8px;">↑</button>
                    {{else}}
                        <button disabled class="btn btn-sm" style="padding:2px 8px;background:#ddd;color:#999;cursor:not-allowed;">↑</button>
                    {{end}}
                    </form>
                    <form style="display:inline;">
                    {{ $.CSRFField }}
                    {{$nextIndex := add $index 1}}
                    {{if lt $nextIndex $productCount}}
                        <button type="submit" formmethod="POST" formaction="/site/{{$.Website.ID}}/products/{{$product.ID}}/reorder/down" class="btn btn-sm btn-success" style="padding:2px 8px;">↓</button>
                    {{else}}
                        <button disabled class="btn btn-sm" style="padding:2px 8px;background:#ddd;color:#999;cursor:not-allowed;">↓</button>
                    {{end}}
                    </form>
                </td>
                <td><strong>{{$product.Name}}</strong></td>
                <td><code>{{$product.Slug}}</code></td>
                <td>${{printf "%.2f" $product.Price}}</td>
                <td>{{$product.SKU}}</td>
                <td>
                    {{if $product.Variants}}
                        {{range $vIndex, $variant := $product.Variants}}
                            {{if $vIndex}}, {{end}}
                            {{if eq $variant.InventoryQuantity -1}}
                                <span style="{{if le $product.InventoryQuantity 0}}color: #e74c3c; font-weight: 600;{{end}}">
                                    {{$variant.Title}}: {{$product.InventoryQuantity}}
                                </span>
                            {{else}}
                                <span style="{{if eq $variant.InventoryQuantity 0}}color: #e74c3c; font-weight: 600;{{end}}">
                                    {{$variant.Title}}: {{$variant.InventoryQuantity}}
                                </span>
                            {{end}}
                        {{end}}
                    {{else}}
                        <span style="{{if eq $product.InventoryQuantity 0}}color: #e74c3c; font-weight: 600;{{end}}">
                            {{$product.InventoryQuantity}}
                        </span>
                    {{end}}
                </td>
                <td>{{$product.Status}}</td>
                <td class="actions">
                    <a href="/site/{{$.Website.ID}}/products/{{$product.ID}}/edit" class="btn btn-sm">Edit</a>
                    <form method="POST" action="/site/{{$.Website.ID}}/products/{{$product.ID}}/delete" style="display:inline;" onsubmit="return confirm('Delete this product?');">
                        {{ $.CSRFField }}
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {{end}}
        </tbody>
    </table>
    {{else}}
    <div class="empty-state">
        <h3>No products yet</h3>
        <p>Create your first product to get started.</p>
        <a href="/site/{{.Website.ID}}/products/new" class="btn">Create Product</a>
    </div>
    {{end}}
</div>
{{end}}
